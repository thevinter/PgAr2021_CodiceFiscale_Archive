/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ttt.codicefiscale.graphics;

import java.io.File;
import java.io.IOException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import javax.swing.UIManager;
import javax.swing.UnsupportedLookAndFeelException;
import javax.swing.filechooser.FileNameExtensionFilter;
import ttt.codicefiscale.flow.ControlloElementi;
import ttt.codicefiscale.io.XMLLoader;
import ttt.codicefiscale.utilita.ControlloCodiceFiscale;
import ttt.codicefiscale.utilita.ConvertiCodice;
import ttt.utils.xml.document.XMLDocument;
import ttt.utils.xml.io.XMLWriter;

/**
 * Form che permette l'interazione con l'utente.
 *
 * @author TTT
 */
public class CodiciGUI extends javax.swing.JFrame {

    private File comuni;
    private File persone;
    private File codicifiscali;

    private XMLDocument comuni_xml;
    private XMLDocument persone_xml;
    private XMLDocument codicifiscali_xml;
    ControlloElementi ce = new ControlloElementi();

    /**
     * Creates new form CodiciGUI
     */
    public CodiciGUI() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanel8 = new javax.swing.JPanel();
        jPanel5 = new javax.swing.JPanel();
        res_cont_codes = new javax.swing.JLabel();
        checkCodes = new javax.swing.JButton();
        jPanel7 = new javax.swing.JPanel();
        res_gen_output = new javax.swing.JLabel();
        saveToFile = new javax.swing.JButton();
        jPanel6 = new javax.swing.JPanel();
        generateCodes = new javax.swing.JButton();
        res_gen_codes = new javax.swing.JLabel();
        loadPanel = new javax.swing.JPanel();
        loadXMLs = new javax.swing.JButton();
        res_load = new javax.swing.JLabel();
        selectPanel = new javax.swing.JPanel();
        jPanel4 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        selectCodici = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        selectPersone = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        selectComuni = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Generatore Codici Fiscali");
        setAlwaysOnTop(true);
        setName("jframe"); // NOI18N
        setSize(new java.awt.Dimension(620, 330));

        jPanel1.setPreferredSize(new java.awt.Dimension(650, 250));

        res_cont_codes.setText("Risultato");
        res_cont_codes.setEnabled(false);
        res_cont_codes.setVisible(false);

        checkCodes.setText("Esegui controllo codici");
        checkCodes.setEnabled(false);
        checkCodes.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                checkCodesActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(checkCodes, javax.swing.GroupLayout.PREFERRED_SIZE, 197, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(res_cont_codes, javax.swing.GroupLayout.PREFERRED_SIZE, 359, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(checkCodes)
                    .addComponent(res_cont_codes))
                .addContainerGap())
        );

        res_gen_output.setText("Risultato");
        res_gen_output.setEnabled(false);
        res_gen_output.setVisible(false);

        saveToFile.setText("Salva risultato");
        saveToFile.setEnabled(false);
        saveToFile.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveToFileActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel7Layout = new javax.swing.GroupLayout(jPanel7);
        jPanel7.setLayout(jPanel7Layout);
        jPanel7Layout.setHorizontalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(saveToFile, javax.swing.GroupLayout.PREFERRED_SIZE, 197, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(res_gen_output, javax.swing.GroupLayout.PREFERRED_SIZE, 359, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel7Layout.setVerticalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(saveToFile)
                    .addComponent(res_gen_output))
                .addContainerGap())
        );

        generateCodes.setText("Genera codici fiscali");
        generateCodes.setEnabled(false);
        generateCodes.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                generateCodesActionPerformed(evt);
            }
        });

        res_gen_codes.setText("Risultato");
        res_gen_codes.setEnabled(false);
        res_gen_codes.setVisible(false);

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(generateCodes, javax.swing.GroupLayout.PREFERRED_SIZE, 197, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(res_gen_codes, javax.swing.GroupLayout.PREFERRED_SIZE, 365, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(generateCodes)
                    .addComponent(res_gen_codes))
                .addContainerGap())
        );

        javax.swing.GroupLayout jPanel8Layout = new javax.swing.GroupLayout(jPanel8);
        jPanel8.setLayout(jPanel8Layout);
        jPanel8Layout.setHorizontalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel7, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );
        jPanel8Layout.setVerticalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel7, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        loadXMLs.setText("Carica e leggi XMLs");
        loadXMLs.setEnabled(false);
        loadXMLs.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                loadXMLsActionPerformed(evt);
            }
        });

        res_load.setText("Risultato");
        res_load.setEnabled(false);
        res_load.setVisible(false);

        javax.swing.GroupLayout loadPanelLayout = new javax.swing.GroupLayout(loadPanel);
        loadPanel.setLayout(loadPanelLayout);
        loadPanelLayout.setHorizontalGroup(
            loadPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(loadPanelLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(loadXMLs, javax.swing.GroupLayout.PREFERRED_SIZE, 197, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(res_load, javax.swing.GroupLayout.PREFERRED_SIZE, 365, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
        loadPanelLayout.setVerticalGroup(
            loadPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(loadPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(loadPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(loadXMLs)
                    .addComponent(res_load))
                .addContainerGap())
        );

        jLabel3.setText("Seleziona file codici fiscali:");

        selectCodici.setText("Seleziona");
        selectCodici.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                selectCodiciActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(selectCodici, javax.swing.GroupLayout.PREFERRED_SIZE, 368, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(selectCodici))
                .addContainerGap())
        );

        jLabel2.setText("Seleziona file persone:");

        selectPersone.setText("Seleziona");
        selectPersone.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                selectPersoneActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(selectPersone, javax.swing.GroupLayout.PREFERRED_SIZE, 368, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(selectPersone))
                .addContainerGap())
        );

        jLabel1.setText("Seleziona file comuni:");

        selectComuni.setText("Seleziona");
        selectComuni.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                selectComuniActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(selectComuni, javax.swing.GroupLayout.PREFERRED_SIZE, 368, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(selectComuni))
                .addContainerGap())
        );

        javax.swing.GroupLayout selectPanelLayout = new javax.swing.GroupLayout(selectPanel);
        selectPanel.setLayout(selectPanelLayout);
        selectPanelLayout.setHorizontalGroup(
            selectPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(selectPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(selectPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jPanel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );
        selectPanelLayout.setVerticalGroup(
            selectPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(selectPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(6, 6, 6)
                        .addComponent(loadPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jPanel8, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(selectPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(46, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(selectPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(loadPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jPanel8, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 304, Short.MAX_VALUE)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    /**
     * Alla pressione del tasto per generare i codici fiscali delle persone
     * caricate.
     *
     * @param evt L'evento (ignorato)
     */
    private void generateCodesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_generateCodesActionPerformed
        if (persone_xml != null) {
            ce.riempiTabella(persone_xml);
            checkCodes.setEnabled(true);
            generateCodes.setEnabled(false);
            res_gen_codes.setText("Sono stati generati " + ce.getSize() + " codici fiscali");
            res_gen_codes.setVisible(true);
        }
    }//GEN-LAST:event_generateCodesActionPerformed

    /**
     * Alla pressione del tasto per generare controllare i codici fiscali
     * dell'elenco caricato.
     *
     * @param evt L'evento (ignorato)
     */
    private void checkCodesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_checkCodesActionPerformed
        if (codicifiscali_xml != null) {
            ce.controllaCodici(codicifiscali_xml);
            checkCodes.setEnabled(false);
            saveToFile.setEnabled(true);
            res_cont_codes.setText("Sono stati controllati " + ce.getSize() + " codici");
            res_cont_codes.setVisible(true);
        }
    }//GEN-LAST:event_checkCodesActionPerformed
    /**
     * Alla pressione del tasto viene creato il file finale che contiene le
     * informazioni sulle persone e la presenza dei codici fiscali.
     *
     * @param evt L'evento (ignorato)
     */
    private void saveToFileActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveToFileActionPerformed
        // TODO add your handling code here:
        File to_save = selectFile("Salva output", false, new File(System.getProperty("user.dir") + File.separatorChar + "codiciPersone.xml"));
        XMLDocument generaOutput = ce.generaOutput(to_save);
        XMLWriter xmlw = new XMLWriter(to_save);
        xmlw.writeDocument(generaOutput);
        res_gen_output.setText("File salvato correttamente.");
        res_gen_output.setVisible(true);
        saveToFile.setEnabled(false);
        JOptionPane.showMessageDialog(this, "Salvato con successo!", "Salvataggio", JOptionPane.INFORMATION_MESSAGE);
        System.exit(0);
    }//GEN-LAST:event_saveToFileActionPerformed

    /**
     * Alla pressione del tasto si può scegliere il file che verrà interpretato
     * come lista dei comuni.
     *
     * @param evt L'evento (ignorato)
     */
    private void selectComuniActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_selectComuniActionPerformed
        // TODO add your handling code here:
        File selectFile = selectFile("Seleziona codici comuni", true, new File(System.getProperty("user.dir") + File.separatorChar + "comuni.xml"));
        if (selectFile != null) {
            comuni = selectFile;
            selectComuni.setText(comuni.getAbsolutePath());
            refreshAvailable();
        }
    }//GEN-LAST:event_selectComuniActionPerformed
    /**
     * Alla pressione del tasto si può scegliere il file che verrà interpretato
     * come lista delle persone.
     *
     * @param evt L'evento (ignorato)
     */
    private void selectPersoneActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_selectPersoneActionPerformed
        // TODO add your handling code here:
        File selectFile = selectFile("Seleziona lista persone", true, new File(System.getProperty("user.dir") + File.separatorChar + "inputPersone.xml"));
        if (selectFile != null) {
            persone = selectFile;
            selectPersone.setText(persone.getAbsolutePath());
            refreshAvailable();
        }
    }//GEN-LAST:event_selectPersoneActionPerformed
    /**
     * Alla pressione del tasto si può scegliere il file che verrà interpretato
     * come lista dei codici fiscali.
     *
     * @param evt L'evento (ignorato)
     */
    private void selectCodiciActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_selectCodiciActionPerformed
        // TODO add your handling code here:
        File selectFile = selectFile("Seleziona lista codici fiscali", true, new File(System.getProperty("user.dir") + File.separatorChar + "codiciFiscali.xml"));
        if (selectFile != null) {
            codicifiscali = selectFile;
            selectCodici.setText(codicifiscali.getAbsolutePath());
            refreshAvailable();
        }
    }//GEN-LAST:event_selectCodiciActionPerformed

    /**
     * Alla pressione del tasto vengono caricati e letti i file precedentemente
     * selezionati.
     *
     * @param evt L'evento (ignorato)
     */
    private void loadXMLsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_loadXMLsActionPerformed
        try {
            comuni_xml = XMLLoader.loadDocument(XMLLoader.TipoXML.COMUNI, comuni, new File("comuni.tmp"));
            if (comuni_xml.getFirstElement("comuni") == null) {
                throw new NullPointerException("File 'comuni' non corretto.");
            }
        } catch (NullPointerException | IOException ex) {
            res_load.setText(ex.getMessage());
            res_load.setVisible(true);
            return;
        }
        try {
            codicifiscali_xml = XMLLoader.loadDocument(XMLLoader.TipoXML.CODICI_FISCALI, codicifiscali, new File("codici.tmp"));
            if (codicifiscali_xml.getFirstElement("codici") == null) {
                throw new NullPointerException("File 'codici fiscali' non corretto.");
            }
        } catch (NullPointerException | IOException ex) {
            res_load.setText(ex.getMessage());
            res_load.setVisible(true);
            return;
        }
        try {
            persone_xml = XMLLoader.loadDocument(XMLLoader.TipoXML.PERSONE, persone, new File("persone.tmp"));
            if (persone_xml.getFirstElement("persone") == null) {
                throw new NullPointerException("File 'persone' non corretto.");
            }
        } catch (NullPointerException | IOException ex) {
            res_load.setText(ex.getMessage());
            res_load.setVisible(true);
            return;
        }
        ControlloCodiceFiscale.setConvertitore(new ConvertiCodice(comuni_xml));
        selectPanel.setEnabled(false);
        loadPanel.setEnabled(false);
        res_load.setVisible(true);
        res_load.setText("Caricato con successo!");
        selectCodici.setEnabled(false);
        selectComuni.setEnabled(false);
        selectPersone.setEnabled(false);
        generateCodes.setEnabled(true);
        loadXMLs.setEnabled(false);
    }//GEN-LAST:event_loadXMLsActionPerformed

    /**
     * Abilita il tasto di caricamento solo se i file sono stati selezionati.
     */
    public void refreshAvailable() {
        if (comuni != null && persone != null && codicifiscali != null) {
            loadXMLs.setVisible(true);
            loadXMLs.setEnabled(true);
        }
    }

    /**
     * Mostra la schermata di selezione e salvataggio di un file.
     *
     * @param title Titolo della finestra
     * @param open Se {@code true} allora viene mostrata la finestra per
     * selezionare un file, altrimenti per salvarlo.
     * @param expected_file Il file che ci si aspetta essere selezionato.
     * @return Il file selezionato, se presente.
     */
    private File selectFile(String title, boolean open, File expected_file) {
        JFileChooser chooser = new JFileChooser();
        chooser.setDialogTitle(title);
        chooser.setMultiSelectionEnabled(false);
        chooser.setAcceptAllFileFilterUsed(false);
        chooser.setSelectedFile(expected_file);
        chooser.setFileFilter(new FileNameExtensionFilter("XML File", "xml"));
        chooser.setFileSelectionMode(JFileChooser.FILES_ONLY);
        int option = open ? chooser.showOpenDialog(this) : chooser.showSaveDialog(this);
        if (option == JFileChooser.APPROVE_OPTION) {
            return chooser.getSelectedFile();
        }
        return null;
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        try {
            javax.swing.UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | UnsupportedLookAndFeelException ex) {
            Logger.getLogger(CodiciGUI.class.getName()).log(Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(() -> {
            new CodiciGUI().setVisible(true);
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton checkCodes;
    private javax.swing.JButton generateCodes;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel loadPanel;
    private javax.swing.JButton loadXMLs;
    private javax.swing.JLabel res_cont_codes;
    private javax.swing.JLabel res_gen_codes;
    private javax.swing.JLabel res_gen_output;
    private javax.swing.JLabel res_load;
    private javax.swing.JButton saveToFile;
    private javax.swing.JButton selectCodici;
    private javax.swing.JButton selectComuni;
    private javax.swing.JPanel selectPanel;
    private javax.swing.JButton selectPersone;
    // End of variables declaration//GEN-END:variables
}
